# Сервис «Оставьте отзыв»

Сервис на PHP для сбора отзывов от клиентов по уникальной ссылке.  

> **Требования ТЗ**:  
> - Форма с оценкой от 1 до 5  
> - Поле комментария (необязательное)  
> - Сохранение в БД  
> - Проверка `client_id` из URL  
> - Заглушка при недействительной ссылке  
> - Модульность, низкая связанность, валидация, покрытие тестами

---

## Возможности
- Оценка от 1 до 5
- Необязательный текстовый комментарий
- Привязка отзыва к клиенту по `client_id` из URL
- Защита от недействительных ссылок
- Валидация и безопасное сохранение данных

---

## Технологии
- **Язык**: PHP 8.0+
- **База данных**: PostgreSQL
- **Архитектура**: MVC-like, интерфейсы для расширяемости (`SurveyInterface`)
- **Безопасность**: 
  - Prepared statements (защита от SQL-инъекций)
  - `htmlspecialchars()` (защита от XSS)
  - Валидация на всех уровнях (HTTP → контроллер → модель → БД)
- **Автозагрузка**: PSR-4 через Composer
- **Тестирование**: PHPUnit

---

## Запуск проекта

1. **Клонируйте репозиторий**
   ```bash
   git clone https://github.com/onmitsukido/feedback_form.git
   cd feedback_form

2. **Установите зависимости**
   ```bash
   composer install
   ```

3. **Настройте базу данных**
   - Создайте БД в PostgreSQL:
     ```sql
     CREATE DATABASE feedback_db;
     ```
   - Выполните миграцию:
     ```bash
     psql -U username -d feedback_db -f migrations/01_create_tables.sql
     ```

4. **Создайте файл конфигурации**
   ```bash
   cp example.env .env
   ```
   Отредактируйте `.env`, указав свои параметры подключения к БД.

5. **Запустите встроенный сервер PHP**
   ```bash
   cd public
   php -S localhost:8000
   ```

6. **Откройте в браузере**
   - Рабочая ссылка: http://localhost:8000/?client_id=123  
     (ID 123 добавлен в миграции как тестовый клиент)
   - Нерабочая ссылка: http://localhost:8000/?client_id=999
     (заглушка)

---

## Тесты

Проект включает unit-тесты для моделей Client и Feedback.

Запуск тестов:
```bash
vendor/bin/phpunit
```

Ожидаемый результат:
```
OK (6 tests, 8 assertions)
```

---

## Структура проекта
```
feedback_form/
├── config/              # Конфигурация БД
├── migrations/          # Скрипты SQL для создания таблиц
├── public/              # index.php
├── src/
│   ├── Controllers/
│   ├── Interfaces/      # Интерфейс SurveyInterface
│   ├── Models/          # Работа с данными (Client, Feedback)
│   ├── Services/        # Соединение с БД
│   └── Surveys/         # Реализация опроса
├── tests/               # Unit-тесты
├── vendor/              # Зависимости
├── composer.json
├── example.env          # Пример .env
└── README.md
```

---

> Проект реализован без фреймворков, на чистом PHP.